{% extends "base.html" %}
{% from "macros.html" import  pagination_collected_post with context %}
{% from "macros.html" import pagination_widget_blog with context %}
{% from "macros.html" import pagination_followeds with context %}
{% from "macros.html" import pagination_followers %}
{% block page_content %}
    <div class="col-lg-3 col-lg-offset-1 box_user" style="position: absolute; top:100px;">
        <div class="row" style="height: 60px">
            <div class="col-lg-8">头像:<img src="{{ url_for('static',filename=real_avatar(user)) }}"></div>
            <div class="col-lg-4">昵称:{{ user.username }}</div>
        </div>
        <div class="row" style="height: 10px">
            <div class="col-lg-3">文章:<small class="badge badge-primary">{{ user.posts.count() }}</small></div>
            <div class="col-lg-3">收藏:<small
                    class="badge badge-primary">{{ user.collection_posts.count() }}</small></div>
            <div class="col-lg-3">关注: <small class="badge"> {{ followed_number(user) }} </small></div>
            <div class="col-lg-3">粉丝: <small class="badge"> {{ follower_number(user) }} </small></div>
        </div>
        <div class="row" style="height: 10px">
            <div class="col-lg-12">个性签名:{% if user.about_me %}{{ user.about_me }}{% endif %}</div>
        </div>
        <div class="row" style="height: 10px">
            <div class="col-lg-6">性别:{% if user.sex %}{{ user.sex }}{% endif %}</div>
            <div class="col-lg-6">所在地:{% if user.location %}{{ user.location }} {% endif %}</div>
        </div>
        <div class="row" style="height: 10px">
            <div class="col-lg-6">注册时间:{{ moment(user.logon_time).format('LL') }}</div>
            <div class="col-lg-6">登录时间:{{ moment(user.login_time).format('LL') }}</div>
        </div>
        <div class="row">
            <div class="col-lg-2">
                {% if not is_follow(current_user,user) %}
                    <a class="label label-success"
                       href="{{ url_for('main.follow_other',username=user.username,flag='from_other',from_=user.username) }}">
                        关注</a>
                {% else %}
                    <a class="label label-success"
                       href="{{ url_for('main.un_follow_other',username=user.username,flag='from_other',from_=user.username) }}">
                        取消关注</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-5 col-lg-offset-4 " style="position: absolute; top: 100px;left: 20px">
        <div class="row">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active">
                    <a href="#home" data-toggle="tab">文章</a>
                </li>
                <li><a href="#collect" data-toggle="tab">收藏</a></li>
                <li><a href="#follow" data-toggle="tab">关注</a></li>
                <li><a href="#fans" data-toggle="tab">粉丝</a></li>
            </ul>
        </div>
        {#        显示nav#}
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade in active" id="home">
                {% if not is_personal(user) or is_closely(user) %}
                    {% if not posts %}
                        <h3>
                            {% if user.sex=='男' %}他{% else %}她{% endif %}他还没有写过文章
                        </h3>
                    {% else %}
                        {% for post in posts %}
                            <div style="padding: 20px 24px 16px 24px;background-color: #ffffff;margin-bottom: 16px;">
                                {% if post.author.username==user.username %}
                                    <h3 class="text-primary"><a
                                            href="{{ url_for('blog.show_signal_post',username=post.author.username,id =post.id) }}">{{ post.title }}</a>
                                    </h3>
                                    <p>{{ post.body_html|striptags|truncate }}
                                        <small>
                                            <a href="{{ url_for('blog.show_signal_post',username=post.author.username,id=post.id) }}">Read
                                                More</a></small>
                                    </p>
                                    <small>
                                        Comments: <a
                                            href="{{ url_for('blog.show_signal_post',username=post.author.username,id=post.id) }}"><span
                                            class="badge">{% if post.comments %} {{ post.comments.count() }}{% else %}
                                        0 {% endif %} </span></a>&nbsp;&nbsp;
                                        <a href="{{ url_for('auth.display_other',username=post.author.username) }}">{{ post.author.username }}</a>
                                        <span class="float-right">发表时间:{{ moment(post.timestamp).format('LLL') }}</span>
                                        <span><a class="label label-primary"
                                                 href="{{ url_for('blog.display_category_posts',category_name=judge_category(post.id)) }}">{{ judge_category(post.id) }}</a></span>
                                    </small>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% endif %}
                    {% if  posts %}
                        {{ pagination_widget_blog(pagination,endpoint,current_user) }}
                    {% endif %}
                {% else %}
                    <p>对方隐藏TA发表的文章</p>
                {% endif %}
            </div>
            <div class="tab-pane fade " id="collect">
                {% if is_show_collect_post(user) %}
                    {% if collect_posts %}
                        {% for post in collect_posts %}
                            <div style="padding: 20px 24px 16px 24px;background-color: #ffffff;margin-bottom: 16px;">
                                <li class="post-ul">
                                    <h3 class="text-primary"><a
                                            href="{{ url_for('blog.show_collect_signal_post',id =post.id) }}">{{ post.title }}</a>
                                    </h3>
                                    <p>{{ post.body_html|striptags|truncate }}
                                        <small>
                                            <a href="{{ url_for('blog.show_collect_signal_post',id=post.id) }}">Read
                                                More</a></small>
                                    </p>
                                    <small>
                                        Comments: <a
                                            href="{{ url_for('blog.show_collect_signal_post',id=post.id) }}"><span
                                            class="badge">{% if post.comments %} {{ post.comments.count() }}{% else %}
                                        0 {% endif %} </span></a>&nbsp;&nbsp;
                                        <a href="{{ url_for('auth.display_other',username=post.author.username) }}">{{ post.author.username }}</a>
                                        <span class="float-right">收藏时间:{{ moment(post.timestamp).format('LLL') }}</span>
                                        <span><a class="label label-primary"
                                                 href="{{ url_for('blog.display_category_posts',category_name=judge_category(post.id)) }}">{{ judge_category(post.id) }}</a></span>
                                    </small>
                                </li>
                            </div>
                        {% endfor %}
                    {% else %}
                        <h3>{% if user.sex=='男' %}他{% else %}她{% endif %}还没有收藏博客呢</h3>
                    {% endif %}
                    {% if  collect_posts %}
                        {{ pagination_collected_post(collect_pagination,endpoint,current_user) }}
                    {% endif %}
                {% else %}
                    <p>对方隐藏TA收藏的文章了</p>
                {% endif %}
            </div>
            <div class="tab-pane fade" id="follow">
            {% if is_show_followed(user) %}
                {% if followed_users %}
                    {% for f in followed_users %}
                        <div style="padding: 20px 24px 16px 24px;background-color: #ffffff;margin-bottom: 16px;">
                            <ul>
                                <li style="list-style: none">
                                <span class="glyphicon glyphicon-user"><a class="label label-success "
                                                                          href="{{ url_for('auth.display_other',username=f.username) }}">{{ f.username }}</a></span>
                                    关注时间:{{ moment(other_followed_time(user)).format('LLL') }}
                                    {% if is_follow(current_user,f) %}<a class="label label-success " href="
                                    {{ url_for('main.un_follow_other',username=f.username,flag='from_other',from_=user.username) }} ">
                                        取消关注</a>{% else %}<a class="label label-success " href="
                                    {{ url_for('main.follow_other',username=f.username,flag='from_other',from_=user.username) }} ">
                                        关注</a>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    {% endfor %}
                {% endif %}
                {% if followeed_users %}
                    {{ pagination_followeds(followed_pagination,endpoint,current_user_) }}
                {% endif %}
            {% else %}
                <h3 style="text-align: center">对方隐藏了关注列表</h3>
            {% endif %}
            </div>
            <div class="tab-pane fade" id="fans">
            {% if is_show_fans(user) %}
                {% for f in follower_users %}
                    <div style="padding: 20px 24px 16px 24px;background-color: #ffffff;margin-bottom: 16px;">
                        <ul>
                            <li style="list-style: none">

                                <span class="glyphicon glyphicon-user"><a class="label label-success "
                                                                          href="{{ url_for('auth.display_other',username=f.username) }}">{{ f.username }}</a></span>

                                {% if is_follower(current_user,f) %}<a class="label label-success " href="
                                   {{ url_for('main.un_follow_other',username=f.username,flag='from_other',from_=user.username) }} ">
                                    取消关注</a>{% else %}<a class="label label-success " href="
                                    {{ url_for('main.follow_other',username=f.username,flag='from_other',from_=user.username) }} ">
                                    关注</a>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                {% endfor %}
                {% if follower_users %}
                    {{ pagination_followers(follower_pagination,endpoint,current_user) }}
                {% endif %}
            {% else %}
                <h3 style="text-align: center;">对方隐藏了粉丝列表</h3>
            {% endif %}
            </div>
        </div>
    </div>
    <div class="list-group col-lg-2 col-lg-offset-10" style="top:100px">
        {% for category in categories %}
            <a class="list-group-item"
               href="{{ url_for('blog.display_category_posts',category_name=inquire_category_name(category.category_name)) }}">{{ category.category_name }}
                <small
                        class="badge badge-success">{{ category.posts.count() }}</small></a>
        {% endfor %}
    </div>
{% endblock %}
{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static',filename="css/user.css") }}">
    <link rel="stylesheet" href="{{ url_for('static',filename="css/post.css") }}">
{% endblock %}